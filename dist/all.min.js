!function(){"use strict";angular.module("ui.bootstrap.datetimepicker",[]).constant("dateTimePickerConfig",{dropdownSelector:null,minuteStep:5,minView:"minute",startView:"day",weekStart:0}).directive("cnDatetimepicker",function(){return{restrict:"E",require:"ngModel",template:'<div dropdown class="dropdown">  <div class="input-group" data-target="#" id="{{inputId}}-container"       dropdown-toggle ng-disabled="{{isDisabled}}">    <input type="text" class="form-control"            id="{{inputId}}"            name="{{inputId}}"            ng-model="formattedNgModel"            ng-blur="updateModel()"            ng-disabled="isDisabled"            ng-required="required">    <span class="input-group-btn">      <button class="btn" ng-disabled="isDisabled">        <i class="fa fa-calendar"></i>      </button>    </span>  </div>  <ul class="dropdown-menu" role="menu">    <li>      <datetimepicker         data-ng-model="ngModel"         data-min-date="minDate" '+"        data-datetimepicker-config=\"{ dropdownSelector: '#' + inputId + '-container', minView: minView || 'minute' }\">      </datetimepicker>    </li>  </ul></div>",scope:{ngModel:"=",minDate:"=",minView:"@",isDisabled:"=",inputId:"@",formatString:"@",modelType:"@",required:"=",onChange:"&"},link:function(e,t,a,n){e.modelFormat="YYYY-MM-DD HH:mm:ss",t.find("input").bind("keydown keypress",function(t){13===t.which&&(t.stopPropagation(),t.preventDefault(),e.$apply(e.updateModel))}),e.updateModel=function(){var t=moment(e.formattedNgModel);e.formattedNgModel&&n.$setViewValue("string"===e.modelType?t.format(e.modelFormat):t.toDate())},e.$watch("ngModel",function(t){var a;console.log("$scope.ngModel, newVal:",e.ngModel,t),e.ngModel&&(e.formattedNgModel=moment(e.ngModel).format(e.formatString||"M/DD/YYYY h:mm a"),"string"===e.modelType?a=moment(e.ngModel).format(e.modelFormat):e.ngModel instanceof Date||(a=moment(e.ngModel).toDate())),a&&a!==e.ngModel&&(e.ngModel=a),e.onChange&&e.onChange({$value:t}),n.$setValidity("schemaForm",!0),e.required&&n.$setValidity("tv4-302",!!e.ngModel)})}}}).directive("datetimepicker",["dateTimePickerConfig",function(e){var t=function(e){var t=["startView","minView","minuteStep","dropdownSelector","weekStart"];for(var a in e)if(e.hasOwnProperty(a)&&t.indexOf(a)<0)throw"invalid option: "+a;var n=["minute","hour","day","month","year"];if(n.indexOf(e.startView)<0)throw"invalid startView value: "+e.startView;if(n.indexOf(e.minView)<0)throw"invalid minView value: "+e.minView;if(n.indexOf(e.minView)>n.indexOf(e.startView))throw"startView must be greater than minView";if(!angular.isNumber(e.minuteStep))throw"minuteStep must be numeric";if(e.minuteStep<=0||e.minuteStep>=60)throw"minuteStep must be greater than zero and less than 60";if(null!==e.dropdownSelector&&!angular.isString(e.dropdownSelector))throw"dropdownSelector must be a string";if(!angular.isNumber(e.weekStart))throw"weekStart must be numeric";if(e.weekStart<0||e.weekStart>6)throw"weekStart must be greater than or equal to zero and less than 7"};return{restrict:"E",require:"ngModel",template:"<div class='datetimepicker'><table class='table-condensed'>   <thead>       <tr>           <th class='left'               data-ng-click='changeView(data.currentView, data.leftDate, $event)'               ><i class='glyphicon glyphicon-arrow-left'/></th>           <th class='switch' colspan='5'               data-ng-click='changeView(data.previousView, data.currentDate, $event)'>{{ data.title }}</th>           <th class='right'               data-ng-click='changeView(data.currentView, data.rightDate, $event)'             ><i class='glyphicon glyphicon-arrow-right'/></th>       </tr>       <tr>           <th class='dow' data-ng-repeat='day in data.dayNames' >{{ day }}</th>       </tr>   </thead>   <tbody>       <tr data-ng-class='{ hide: data.currentView == \"day\" }' >           <td colspan='7' >              <span class='{{ data.currentView }}'                     data-ng-repeat='dateValue in data.dates'                     data-ng-class='{active: dateValue.active, past: dateValue.past, future: dateValue.future, disabled: dateValue.disabled}'                     data-ng-click=\"changeView(data.nextView, dateValue.date, $event, dateValue.disabled, true)\">{{ dateValue.display }}</span>            </td>       </tr>       <tr data-ng-show='data.currentView == \"day\"' data-ng-repeat='week in data.weeks'>           <td data-ng-repeat='dateValue in week.dates'                data-ng-click='changeView(data.nextView, dateValue.date, $event, dateValue.disabled, true)'               class='day'                data-ng-class='{active: dateValue.active, past: dateValue.past, future: dateValue.future, disabled: dateValue.disabled}' >             {{ dateValue.display }}           </td>       </tr>   </tbody></table></div>",scope:{ngModel:"=",onSetTime:"=",minDate:"=",datetimepickerConfig:"=?"},replace:!0,link:function(a,n,i){var r={};a.datetimepickerConfig?r=a.datetimepickerConfig:i.datetimepickerConfig&&(r=a.$eval(i.datetimepickerConfig));var d={};angular.extend(d,e,r),t(d);var o={year:function(e){for(var t=moment(e).startOf("year"),n=10*parseInt(t.year()/10,10),i=moment(t).year(n-1).startOf("year"),r=a.ngModel?moment(a.ngModel).year():0,o={currentView:"year",nextView:"year"===d.minView?"setTime":"month",title:n+"-"+(n+9),leftDate:moment(i).subtract(9,"year").valueOf(),rightDate:moment(i).add(11,"year").valueOf(),dates:[],setUnits:["year"]},m=0;12>m;m++){var s=moment(i).add(m,"years"),l={date:s.valueOf(),display:s.format("YYYY"),past:s.year()<n,future:s.year()>n+9,active:s.year()===r,disabled:a.minDate&&s.year()<moment(a.minDate).year()};o.dates.push(l)}return o},month:function(e){for(var t=moment(e).startOf("year"),n=a.ngModel?moment(a.ngModel).format("YYYY-MMM"):0,i={previousView:"year",currentView:"month",nextView:"month"===d.minView?"setTime":"day",currentDate:t.valueOf(),title:t.format("YYYY"),leftDate:moment(t).subtract(1,"year").valueOf(),rightDate:moment(t).add(1,"year").valueOf(),dates:[],setUnits:["year","month"]},r=0;12>r;r++){var o=moment(t).add(r,"months"),m={date:o.valueOf(),display:o.format("MMM"),active:o.format("YYYY-MMM")===n,disabled:a.minDate&&o.add(1,"month").isBefore(a.minDate)};i.dates.push(m)}return i},day:function(e){for(var t=moment(e),n=moment(t).startOf("month"),i=moment(t).endOf("month"),r=moment(n).subtract(Math.abs(n.weekday()-d.weekStart),"days"),o=a.ngModel?moment(a.ngModel).format("YYYY-MMM-DD"):"",m={previousView:"month",currentView:"day",nextView:"day"===d.minView?"setTime":"hour",currentDate:t.valueOf(),title:t.format("YYYY-MMM"),leftDate:moment(n).subtract(1,"months").valueOf(),rightDate:moment(n).add(1,"months").valueOf(),dayNames:[],weeks:[],setUnits:["year","month","date"]},s=d.weekStart;s<d.weekStart+7;s++)m.dayNames.push(moment().weekday(s).format("dd"));for(var l=0;6>l;l++){for(var u={dates:[]},c=0;7>c;c++){var f=moment(r).add(7*l+c,"days"),g={date:f.valueOf(),display:f.format("D"),active:f.format("YYYY-MMM-DD")===o,past:f.isBefore(n),future:f.isAfter(i),disabled:a.minDate&&f.add(1,"days").isBefore(a.minDate)};u.dates.push(g)}m.weeks.push(u)}return m},hour:function(e){for(var t=moment(e).hour(0).minute(0).second(0),n=a.ngModel?moment(a.ngModel).format("YYYY-MM-DD H"):"",i={previousView:"day",currentView:"hour",nextView:"hour"===d.minView?"setTime":"minute",currentDate:t.valueOf(),title:t.format("YYYY-MMM-DD"),leftDate:moment(t).subtract(1,"days").valueOf(),rightDate:moment(t).add(1,"days").valueOf(),dates:[],setUnits:["year","month","date","hour"]},r=0;24>r;r++){var o=moment(t).add(r,"hours"),m={date:o.valueOf(),display:o.format("h a").toUpperCase(),active:o.format("YYYY-MM-DD H")===n,disabled:a.minDate&&o.add(1,"hours").isBefore(a.minDate)};i.dates.push(m)}return i},minute:function(e){for(var t=moment(e).minute(0).second(0),n=a.ngModel?moment(a.ngModel).format("YYYY-MM-DD H:mm"):"",i={previousView:"hour",currentView:"minute",nextView:"setTime",currentDate:t.valueOf(),title:t.format("YYYY-MMM-DD H:mm"),leftDate:moment(t).subtract(1,"hours").valueOf(),rightDate:moment(t).add(1,"hours").valueOf(),dates:[],setUnits:["year","month","date","hour","minute"]},r=60/d.minuteStep,o=0;r>o;o++){var m=moment(t).add(o*d.minuteStep,"minute"),s={date:m.valueOf(),display:m.format("h:mm"),active:m.format("YYYY-MM-DD H:mm")===n,disabled:a.minDate&&m.subtract(1,"minutes").isBefore(a.minDate)};i.dates.push(s)}return i},setTime:function(e,t){var n=new Date(e),i=new Date(n.getTime());return d.dropdownSelector&&!t&&jQuery(d.dropdownSelector).dropdown("toggle"),angular.isFunction(a.onSetTime)&&a.onSetTime(i,a.ngModel),a.ngModel=i,o[a.data.currentView](e)}},m=function(){var e=a.ngModel?moment(a.ngModel).toDate():new Date;return e.getTime()};a.changeView=function(e,t,n,i,r){if(n&&(n.stopPropagation(),n.preventDefault()),!i&&e&&t>-(1/0)&&o[e]){if(r&&"setTime"!==e){var d=moment(t),m=moment(a.ngModel);_.each(a.data.setUnits,function(e){var t=d[e](),a=m[e](t).valueOf();o.setTime(a,!0)})}a.data=o[e](t)}},a.changeView(d.startView,m()),a.$watch("ngModel",function(e,t){e!==t&&a.changeView(a.data.currentView,m())})}}}])}();